<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Page</title>
</head>
<body>
    <h1>Welcome to the Home Page</h1>
    <!-- Container for displaying file list -->
    <div id="fileList"></div>
    <div id="csvTableContainer"></div> <!-- Container to display CSV as a table -->
    <button onclick="goToUpload()">Go to Upload Page</button>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.0/firebase-app.js';
        import { getFirestore, collection, getDocs } from 'https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCT2xu39-AfZKv1KDI3isG5xDZkm9kZoPw",
            authDomain: "projectdp3ak.firebaseapp.com",
            projectId: "projectdp3ak",
            storageBucket: "projectdp3ak.appspot.com",
            messagingSenderId: "602000338998",
            appId: "1:602000338998:web:f33f8953b3690c67efa897"
        };

        // Initialize Firebase
        const firebaseApp = initializeApp(firebaseConfig);
        const db = getFirestore(firebaseApp);

        async function displayData() {
            try {
                const querySnapshot = await getDocs(collection(db, 'files'));
                const fileListElement = document.getElementById('fileList');
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const fileElement = document.createElement('button'); // Changed from <p> to <button>
                    fileElement.textContent = data.name;
                    fileElement.onclick = () => loadAndDisplayCsv(data.url); // Assuming 'url' field contains the direct link to CSV
                    fileListElement.appendChild(fileElement);
                });
            } catch (error) {
                console.error("Error fetching documents: ", error);
                const fileListElement = document.getElementById('fileList');
                fileListElement.textContent = 'Failed to load data.';
            }
        }

        async function loadAndDisplayCsv(url) {
            const response = await fetch(url);
            const csvText = await response.text();
            displayCsvAsTable(csvText);
        }

        function displayCsvAsTable(csvText) {
            const lines = csvText.split('\n');
            const table = document.createElement('table');
            lines.forEach((line, index) => {
                const row = document.createElement('tr');
                const cells = line.split(',');
                cells.forEach(cell => {
                    const cellElement = index === 0 ? document.createElement('th') : document.createElement('td');
                    cellElement.textContent = cell.trim();
                    row.appendChild(cellElement);
                });
                table.appendChild(row);
            });
            const container = document.getElementById('csvTableContainer');
            container.innerHTML = ''; // Clear previous tables
            container.appendChild(table);
        }

        window.addEventListener('load', displayData);

        // Definisikan fungsi goToUpload di sini
        window.goToUpload = function() {
    window.location.href = 'upload.html';
};

    </script>
</body>
</html>
